<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Church App - Admin Portal</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --gold: #D4AF37; --navy: #001a4d; --bg: #f4f4f4; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg); display: flex; }
        
        /* Sidebar Styles */
        .sidebar { width: 250px; background: var(--navy); color: white; height: 100vh; position: fixed; padding: 20px; }
        .sidebar h2 { color: var(--gold); font-size: 20px; margin-bottom: 30px; border-bottom: 1px solid var(--gold); padding-bottom: 10px; }
        .nav-link { padding: 12px; color: white; text-decoration: none; display: block; cursor: pointer; border-radius: 5px; margin-bottom: 5px; transition: 0.3s; }
        .nav-link:hover, .nav-link.active { background: var(--gold); color: var(--navy); font-weight: bold; }

        /* Main Content */
        .main-content { margin-left: 290px; padding: 40px; width: calc(100% - 330px); }
        .section { display: none; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .section.active { display: block; }

        h3 { color: var(--navy); border-bottom: 2px solid var(--gold); padding-bottom: 8px; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; }
        input, textarea, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { background: var(--navy); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: var(--gold); color: var(--navy); }

        /* Folder System Styles */
        .main-folder-dropdown {
            background: #eef2f7;
            border: 2px solid var(--navy);
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .main-folder-header {
            background: var(--navy);
            color: white;
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }
        .folders-container {
            display: none; /* Hidden by default */
            padding: 15px;
            max-height: 500px;
            overflow-y: auto;
        }
        .folder-box { 
            background: #fff; border: 1px solid #ddd; border-radius: 8px; 
            margin-bottom: 10px; overflow: hidden; 
        }
        .folder-header { 
            background: #f9f9f9; padding: 12px; cursor: pointer; 
            display: flex; justify-content: space-between; font-weight: bold;
            border-bottom: 1px solid #eee;
        }

        .post-card { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        .post-card:last-child { border: none; }
        .del-btn { background: #ff4d4d; padding: 5px 10px; font-size: 12px; }
        .reply-box { margin-top: 10px; padding: 10px; background: #f0f4f8; border-radius: 6px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>Admin Portal</h2>
        <div class="nav-link active" onclick="showSection('posts', this)">üìù Manage Posts</div>
        <div class="nav-link" onclick="showSection('slider', this)">üñºÔ∏è Website Images</div>
        <div class="nav-link" onclick="showSection('devotional', this)">‚ú® Daily Devotional</div>
        <div class="nav-link" onclick="showSection('prayers', this)">üôè Prayer Requests</div>
    </div>

    <div class="main-content">
        
        <div id="posts" class="section active">
            <h3>Create New Post</h3>
            <div class="form-group">
                <label>Post Type</label>
                <select id="postType" onchange="toggleFolderInput()">
                    <option value="updates">Home Update</option>
                    <option value="sermons">Sermon (Video/Audio)</option>
                </select>
            </div>
            <div id="folderInputGroup" class="form-group" style="display:none;">
                <label>Folder Name (Category)</label>
                <input type="text" id="postCategory" placeholder="e.g., Sunday Service 2024">
            </div>
            <div class="form-group">
                <label>Message / Title</label>
                <textarea id="postText" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Media Link (Image/Video/MP3/YouTube)</label>
                <input type="text" id="postMedia" placeholder="https://...">
            </div>
            <button onclick="publishPost()">Publish Post</button>

            <h3 style="margin-top:40px;">Existing Content</h3>
            
            <div id="sermon-master-container" class="main-folder-dropdown" style="display:none;">
                <div class="main-folder-header" onclick="toggleMainSermonList()">
                    <span>üìÅ VIEW SERMON FOLDERS</span>
                    <span id="main-folder-icon">‚ñ∂</span>
                </div>
                <div id="master-folders-list" class="folders-container">
                    </div>
            </div>

            <div id="updates-list">
                <h4>Home Updates</h4>
                <div id="home-posts-container"></div>
            </div>
        </div>

        <div id="slider" class="section">
            <h3>Website Slider Images</h3>
            <div class="form-group">
                <label>Slide Image 1 URL</label>
                <input type="text" id="slide1">
            </div>
            <div class="form-group">
                <label>Slide Image 2 URL</label>
                <input type="text" id="slide2">
            </div>
            <button onclick="updateSlider()">Update Slider</button>
        </div>

        <div id="devotional" class="section">
            <h3>Daily Devotional</h3>
            <div class="form-group">
                <label>Bible Verse / Title</label>
                <input type="text" id="devoVerse">
            </div>
            <div class="form-group">
                <label>Devotional Text</label>
                <textarea id="devoText" rows="5"></textarea>
            </div>
            <button onclick="updateDevo()">Update Devotional</button>
        </div>

        <div id="prayers" class="section">
            <h3>Prayer Requests</h3>
            <div id="prayer-list"></div>
        </div>

    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBKJ9Vm28eNy26J0vGkcbig1cLrtKrbtwo",
            authDomain: "unioninchristapp.firebaseapp.com",
            databaseURL: "https://unioninchristapp-default-rtdb.firebaseio.com",
            projectId: "unioninchristapp",
            storageBucket: "unioninchristapp.firebasestorage.app",
            appId: "1:68198927662:web:1ffa7ec16b35d4be88bebf"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function showSection(id, el) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        function toggleFolderInput() {
            const type = document.getElementById('postType').value;
            document.getElementById('folderInputGroup').style.display = (type === 'sermons') ? 'block' : 'none';
        }

        function publishPost() {
            const type = document.getElementById('postType').value;
            const text = document.getElementById('postText').value;
            const image = document.getElementById('postMedia').value;
            const category = document.getElementById('postCategory').value || "General Sermons";
            
            if(!text) return alert("Please enter text");

            const postData = {
                text,
                image,
                category,
                timestamp: Date.now(),
                date: new Date().toLocaleDateString(),
                likes: 0
            };

            db.ref(type).push(postData).then(() => {
                alert("Published!");
                document.getElementById('postText').value = "";
                document.getElementById('postMedia').value = "";
            });
        }

        function toggleMainSermonList() {
            const container = document.getElementById('master-folders-list');
            const icon = document.getElementById('main-folder-icon');
            if(container.style.display === 'block') {
                container.style.display = 'none';
                icon.innerText = '‚ñ∂';
            } else {
                container.style.display = 'block';
                icon.innerText = '‚ñº';
            }
        }

        function toggleFolder(id) {
            const el = document.getElementById(id);
            el.style.display = (el.style.display === 'none' || el.style.display === '') ? 'block' : 'none';
        }

        function loadContent() {
            // Load Home Updates
            db.ref('updates').on('value', s => {
                const container = document.getElementById('home-posts-container');
                container.innerHTML = "";
                const data = s.val();
                if(data) {
                    Object.keys(data).reverse().forEach(k => {
                        container.innerHTML += `
                            <div class="post-card">
                                <div><strong>${data[k].date}</strong>: ${data[k].text.substring(0, 50)}...</div>
                                <button class="del-btn" onclick="deleteItem('updates/${k}')">Delete</button>
                            </div>
                            <div id="admin-comments-${k}" style="margin-bottom:20px; padding-left:20px;"></div>
                        `;
                        loadComments(k);
                    });
                }
            });

            // Load Sermons into Folders
            db.ref('sermons').on('value', s => {
                const masterDiv = document.getElementById('sermon-master-container');
                const list = document.getElementById('master-folders-list');
                list.innerHTML = "";
                const data = s.val();
                
                if(!data) {
                    masterDiv.style.display = 'none';
                    return;
                }

                masterDiv.style.display = 'block';
                let folders = {};
                Object.keys(data).forEach(k => {
                    let cat = data[k].category || "General Sermons";
                    if(!folders[cat]) folders[cat] = [];
                    folders[cat].push({key: k, ...data[k]});
                });

                Object.keys(folders).forEach(catName => {
                    const fId = 'f-' + catName.replace(/\s+/g, '-');
                    const fHtml = `
                        <div class="folder-box">
                            <div class="folder-header" onclick="toggleFolder('${fId}')">
                                <span>üìÅ ${catName} (${folders[catName].length})</span>
                                <span>‚ñº</span>
                            </div>
                            <div id="${fId}" style="display:none; padding:10px;">
                                ${folders[catName].map(item => `
                                    <div class="post-card">
                                        <div style="font-size:13px;">${item.text.substring(0, 40)}...</div>
                                        <button class="del-btn" onclick="deleteItem('sermons/${item.key}')">Del</button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    list.innerHTML += fHtml;
                });
            });

            // Prayer Requests
            db.ref('prayers').on('value', s => {
                const container = document.getElementById('prayer-list');
                container.innerHTML = "";
                const data = s.val();
                if(data) {
                    Object.keys(data).reverse().forEach(k => {
                        container.innerHTML += `
                            <div class="post-card">
                                <div><strong>${data[k].date}</strong>: ${data[k].text}</div>
                                <button class="del-btn" onclick="deleteItem('prayers/${k}')">Clear</button>
                            </div>
                        `;
                    });
                }
            });
        }

        function loadComments(postId) {
            db.ref(`comments/${postId}`).on('value', s => {
                const box = document.getElementById(`admin-comments-${postId}`);
                box.innerHTML = "";
                const data = s.val();
                if(data) {
                    Object.keys(data).forEach(ck => {
                        box.innerHTML += `
                            <div class="reply-box">
                                <strong>${data[ck].userName}:</strong> ${data[ck].text}
                                <div style="margin-top:5px; display:flex; gap:5px;">
                                    <input type="text" id="rep-${ck}" placeholder="Type reply...">
                                    <button style="padding:5px;" onclick="replyToComment('${postId}','${ck}')">Reply</button>
                                </div>
                                <div style="color:var(--gold); font-size:12px; margin-top:5px;">
                                    ${data[ck].adminReply ? 'Admin Replied: ' + data[ck].adminReply : ''}
                                </div>
                            </div>
                        `;
                    });
                }
            });
        }

        function replyToComment(postId, commentId) {
            const reply = document.getElementById(`rep-${commentId}`).value;
            if(!reply) return;
            db.ref(`comments/${postId}/${commentId}/adminReply`).set(reply).then(() => {
                alert("Reply Sent");
                document.getElementById(`rep-${commentId}`).value = "";
            });
        }

        function updateSlider() {
            const img1 = document.getElementById('slide1').value;
            const img2 = document.getElementById('slide2').value;
            db.ref('settings/slider').set({ img1, img2 }).then(() => alert("Slider Updated"));
        }

        function updateDevo() {
            const verse = document.getElementById('devoVerse').value;
            const text = document.getElementById('devoText').value;
            db.ref('settings/devotional').set({ verse, text }).then(() => alert("Devotional Updated"));
        }

        function deleteItem(path) { if(confirm("Delete this?")) db.ref(path).remove(); }

        window.onload = loadContent;
    </script>
</body>
</html>
