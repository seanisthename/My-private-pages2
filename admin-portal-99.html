<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UIC Admin Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --gold: #D4AF37; --navy: #001a4d; --dark-bg: #121212; --card-bg: #1e1e1e; --text-main: #e0e0e0; --border: #333; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--dark-bg); color: var(--text-main); padding-bottom: 40px; }
        header { background: linear-gradient(135deg, #000c24, var(--navy)); color: var(--gold); padding: 25px; text-align: center; border-bottom: 3px solid var(--gold); }
        
        .admin-content { padding: 15px; display: none; }
        .card { background: var(--card-bg); border-radius: 15px; padding: 20px; margin-bottom: 15px; border-top: 4px solid var(--gold); box-shadow: 0 4px 15px rgba(0,0,0,0.4); }
        
        input, textarea, select { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: 1px solid var(--border); background: #2d2d2d; color: white; box-sizing: border-box; }
        
        .btn { background: var(--gold); color: #000; padding: 15px; border: none; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        .menu-btn { background: #2d2d2d; color: var(--gold); border: 1px solid var(--gold); padding: 18px; border-radius: 12px; width: 100%; text-align: left; font-size: 16px; font-weight: bold; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }

        .badge { background: #ff3b30; color: white; font-size: 11px; padding: 2px 7px; border-radius: 8px; margin-left: 8px; }

        .section-content { display: none; margin-bottom: 20px; }
        .admin-item { background: #252525; padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid var(--gold); }
        
        /* COMMENT MODERATION STYLES */
        .comment-box { background: #1a1a1a; padding: 10px; border-radius: 8px; margin-top: 10px; border: 1px solid #333; }
        .comment-text { font-size: 14px; color: #ccc; margin-bottom: 5px; }
        .reply-tag { color: var(--gold); font-weight: bold; font-size: 11px; text-transform: uppercase; }
        .admin-reply-text { color: #50b7f5; font-size: 13px; font-style: italic; margin-top: 3px; }
        
        .reply-input-group { display: flex; gap: 5px; margin-top: 8px; }
        .reply-input-group input { margin-top: 0; padding: 8px; font-size: 13px; }
        .small-btn { padding: 8px 12px; background: var(--gold); border: none; border-radius: 5px; font-weight: bold; font-size: 12px; }
        .del-x { color: #ff3b30; cursor: pointer; float: right; font-weight: bold; }

        #login-screen { max-width: 400px; margin: 40px auto; padding: 20px; }
    </style>
</head>
<body>

    <header>
        <h1>UIC Admin</h1>
        <p style="font-size:12px; color:#888;">Live Interaction Portal</p>
    </header>

    <div id="login-screen" class="card">
        <h3>Admin Access</h3>
        <input type="password" id="admin-key" placeholder="Enter Password">
        <button class="btn" onclick="checkAdmin()">Enter Dashboard</button>
    </div>

    <div id="dashboard" class="admin-content">
        
        <div class="card">
            <h3 style="color:var(--gold); margin:0;">Create Post</h3>
            <select id="post-type">
                <option value="updates">Latest Updates (Home)</option>
                <option value="sermons">Sunday Sermons</option>
            </select>
            <textarea id="post-text" placeholder="Write message..." rows="3"></textarea>
            <input type="text" id="post-img" placeholder="Image URL (Optional)">
            <button class="btn" onclick="publishPost()">Publish Now</button>
        </div>

        <button class="menu-btn" onclick="toggleSection('sec-posts')">Updates <span>▼</span></button>
        <div id="sec-posts" class="section-content"></div>

        <button class="menu-btn" onclick="toggleSection('sec-sermons')">Sermons <span>▼</span></button>
        <div id="sec-sermons" class="section-content"></div>

        <button class="menu-btn" onclick="toggleSection('sec-prayers')">
            Prayers <span id="prayer-badge" class="badge" style="display:none;">0</span> <span>▼</span>
        </button>
        <div id="sec-prayers" class="section-content"></div>

        <button class="btn" style="background:#444; color:white; margin-top:30px;" onclick="logOut()">Log Out</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBKJ9Vm28eNy26J0vGkcbig1cLrtKrbtwo",
            authDomain: "unioninchristapp.firebaseapp.com",
            databaseURL: "https://unioninchristapp-default-rtdb.firebaseio.com",
            projectId: "unioninchristapp",
            storageBucket: "unioninchristapp.firebasestorage.app",
            appId: "1:68198927662:web:1ffa7ec16b35d4be88bebf"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function checkAdmin() {
            if(document.getElementById('admin-key').value === 'church111') {
                localStorage.setItem('uic_admin', 'authenticated');
                showDashboard();
            } else { alert("Access Denied"); }
        }

        function showDashboard() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            loadAdminData();
        }

        function toggleSection(id) {
            const el = document.getElementById(id);
            el.style.display = el.style.display === 'block' ? 'none' : 'block';
        }

        function loadAdminData() {
            // Load Prayers with Badge logic
            db.ref('prayers').on('value', s => {
                const d = s.val();
                const div = document.getElementById('sec-prayers');
                div.innerHTML = "";
                if(d) Object.keys(d).reverse().forEach(k => {
                    div.innerHTML += `<div class="admin-item">
                        <span onclick="deleteItem('prayers/${k}')" class="del-x">✕</span>
                        <p>${d[k].text}</p>
                        <small style="color:var(--gold)">${new Date(d[k].timestamp).toLocaleString()}</small>
                    </div>`;
                });
            });

            // Load Updates and Sermons
            renderManager('updates', 'sec-posts');
            renderManager('sermons', 'sec-sermons');
        }

        function renderManager(type, containerId) {
            db.ref(type).on('value', s => {
                const div = document.getElementById(containerId);
                const data = s.val();
                div.innerHTML = "";
                if(data) Object.keys(data).reverse().forEach(k => {
                    const item = data[k];
                    const itemEl = document.createElement('div');
                    itemEl.className = 'card';
                    itemEl.innerHTML = `
                        <span onclick="deleteItem('${type}/${k}')" class="del-x">DELETE POST</span>
                        <p><strong>Post:</strong> ${item.text.substring(0,50)}...</p>
                        <div id="comments-for-${k}"></div>
                    `;
                    div.appendChild(itemEl);
                    loadCommentsForAdmin(k);
                });
            });
        }

        function loadCommentsForAdmin(postId) {
            db.ref(`comments/${postId}`).on('value', s => {
                const container = document.getElementById(`comments-for-${postId}`);
                const data = s.val();
                container.innerHTML = "<h4 style='color:var(--gold); font-size:12px; margin-bottom:5px;'>COMMENTS:</h4>";
                if(!data) { container.innerHTML += "<small>No comments yet</small>"; return; }

                Object.keys(data).forEach(ck => {
                    const c = data[ck];
                    container.innerHTML += `
                        <div class="comment-box">
                            <span onclick="deleteItem('comments/${postId}/${ck}')" class="del-x">✕</span>
                            <div class="comment-text">${c.text}</div>
                            ${c.adminReply ? `<div class="admin-reply-text"><span class="reply-tag">Admin:</span> ${c.adminReply}</div>` : ''}
                            <div class="reply-input-group">
                                <input type="text" id="reply-to-${ck}" placeholder="Type reply...">
                                <button class="small-btn" onclick="sendReply('${postId}','${ck}')">Reply</button>
                            </div>
                        </div>
                    `;
                });
            });
        }

        function sendReply(postId, commentId) {
            const reply = document.getElementById(`reply-to-${commentId}`).value;
            if(!reply) return;
            db.ref(`comments/${postId}/${commentId}`).update({ adminReply: reply })
            .then(() => alert("Reply Sent!"));
        }

        function publishPost() {
            const type = document.getElementById('post-type').value;
            const text = document.getElementById('post-text').value;
            const image = document.getElementById('post-img').value;
            if(!text) return;
            db.ref(type).push({ 
                text, 
                image, 
                date: new Date().toLocaleDateString(), 
                timestamp: new Date().getTime() 
            }).then(() => {
                document.getElementById('post-text').value = "";
                document.getElementById('post-img').value = "";
                alert("Published!");
            });
        }

        function deleteItem(path) { if(confirm("Delete this permanently?")) db.ref(path).remove(); }
        function logOut() { localStorage.removeItem('uic_admin'); location.reload(); }
        window.onload = () => { if(localStorage.getItem('uic_admin') === 'authenticated') showDashboard(); };
    </script>
</body>
</html>
