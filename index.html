<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Union In Christ - Member App</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --gold: #D4AF37; --navy: #001a4d; --dark-bg: #0a0a0a; --card-bg: #1a1a1a; --text: #ffffff; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--dark-bg); color: var(--text); padding-bottom: 70px; }
        
        /* Header & Navigation */
        header { background: var(--navy); padding: 15px; text-align: center; border-bottom: 2px solid var(--gold); }
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #111; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #333; z-index: 1000; }
        .nav-item { color: #888; font-size: 12px; text-decoration: none; text-align: center; }
        .nav-item.active { color: var(--gold); }
        
        /* General Containers */
        .container { padding: 15px; }
        .page { display: none; }
        .page.active { display: block; }
        
        /* Post Cards */
        .post-card { background: var(--card-bg); border-radius: 12px; padding: 15px; margin-bottom: 20px; border: 1px solid #333; }
        .post-card img { width: 100%; border-radius: 8px; margin: 10px 0; }
        
        /* FOLDER STYLING (New) */
        .folder-wrapper { margin-bottom: 12px; }
        .folder-header { 
            background: #222; 
            padding: 15px; 
            border-radius: 10px; 
            border-left: 4px solid var(--gold); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            cursor: pointer;
            transition: background 0.3s;
        }
        .folder-header:active { background: #333; }
        .folder-name { font-weight: bold; color: var(--gold); font-size: 16px; }
        .folder-count { font-size: 12px; color: #777; background: #111; padding: 2px 8px; border-radius: 10px; }
        .folder-content { 
            display: none; 
            padding: 10px 5px; 
            background: rgba(255, 255, 255, 0.02);
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            margin-bottom: 15px;
        }

        /* Buttons & Interactions */
        .btn { background: var(--gold); color: black; border: none; padding: 10px 15px; border-radius: 6px; font-weight: bold; width: 100%; cursor: pointer; }
        .action-row { display: flex; gap: 15px; margin-top: 10px; color: #bbb; font-size: 14px; }
    </style>
</head>
<body>

    <header>
        <h2 style="color: var(--gold); margin: 0;">UNION IN CHRIST</h2>
    </header>

    <div id="home" class="page active container">
        <h3 style="color: var(--gold);">Word for Today</h3>
        <div id="devotional-box" class="post-card">Loading daily bread...</div>
        
        <h3 style="color: var(--gold);">Latest Updates</h3>
        <div id="updates-list"></div>
    </div>

    <div id="sermons" class="page container">
        <h3 style="color: var(--gold);">Sermon Series</h3>
        <div id="sermon-folders-container"></div>
    </div>

    <div id="prayer" class="page container">
        <h3 style="color: var(--gold);">Prayer Request</h3>
        <div class="post-card">
            <textarea id="prayer-input" style="width:100%; background:#000; color:#fff; border:1px solid #444; border-radius:8px; padding:10px;" rows="4" placeholder="How can we pray for you?"></textarea>
            <button class="btn" style="margin-top:10px;" onclick="submitPrayer()">Send Request</button>
        </div>
        <div id="my-prayers"></div>
    </div>

    <nav class="nav-bar">
        <a href="#" class="nav-item active" onclick="showPage('home')"><div>üè†</div>Home</a>
        <a href="#" class="nav-item" onclick="showPage('sermons')"><div>üìñ</div>Sermons</a>
        <a href="#" class="nav-item" onclick="showPage('prayer')"><div>üôè</div>Prayer</a>
    </nav>

    <script>
        // FIREBASE CONFIGURATION (Using your details)
        const firebaseConfig = {
            apiKey: "AIzaSyBKJ9Vm28eNy26J0vGkcbig1cLrtKrbtwo",
            authDomain: "unioninchristapp.firebaseapp.com",
            databaseURL: "https://unioninchristapp-default-rtdb.firebaseio.com",
            projectId: "unioninchristapp",
            storageBucket: "unioninchristapp.firebasestorage.app",
            appId: "1:68198927662:web:1ffa7ec16b35d4be88bebf"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. PAGE NAVIGATION
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // 2. LOAD UPDATES (Your existing logic)
        function loadUpdates() {
            db.ref('updates').on('value', snap => {
                const list = document.getElementById('updates-list');
                list.innerHTML = "";
                const data = snap.val();
                if(data) {
                    Object.keys(data).reverse().forEach(key => {
                        const post = data[key];
                        list.innerHTML += `
                            <div class="post-card">
                                <p>${post.text}</p>
                                ${post.image ? `<img src="${post.image}">` : ''}
                                <div class="action-row">
                                    <span onclick="likePost('updates/${key}')">‚ù§Ô∏è ${post.likes || 0}</span>
                                    <span>üìÖ ${post.date}</span>
                                </div>
                            </div>`;
                    });
                }
            });
        }

        // 3. LOAD SERMONS WITH FOLDERS (Integrated Logic)
        function loadSermons() {
            db.ref('sermons').on('value', snap => {
                const container = document.getElementById('sermon-folders-container');
                container.innerHTML = "";
                const data = snap.val();
                if(!data) return;

                // Grouping sermons by folder property
                const folders = {};
                Object.keys(data).forEach(key => {
                    const s = data[key];
                    const folderName = s.folder || "General Teachings";
                    if (!folders[folderName]) folders[folderName] = [];
                    folders[folderName].push({ id: key, ...s });
                });

                // Rendering the folders
                Object.keys(folders).forEach(folderName => {
                    const folderId = "f-" + folderName.replace(/\s+/g, '-');
                    
                    const folderSection = document.createElement('div');
                    folderSection.className = "folder-wrapper";
                    folderSection.innerHTML = `
                        <div class="folder-header" onclick="toggleFolder('${folderId}')">
                            <span class="folder-name">üìÅ ${folderName}</span>
                            <span class="folder-count">${folders[folderName].length} Sermons</span>
                        </div>
                        <div id="${folderId}" class="folder-content">
                            ${folders[folderName].reverse().map(sermon => `
                                <div class="post-card" style="margin-top:10px; border-color: #444;">
                                    <h4 style="margin:0; color:var(--gold);">${sermon.text.split('http')[0]}</h4>
                                    <p style="font-size:12px; color:#888;">Published: ${sermon.date}</p>
                                    ${sermon.text.includes('http') ? `<button class="btn" style="background:#333; color:white;" onclick="window.open('${sermon.text.match(/\bhttps?:\/\/\S+/gi)[0]}', '_blank')">‚ñ∂ Play Sermon</button>` : ''}
                                    ${sermon.image ? `<img src="${sermon.image}">` : ''}
                                </div>
                            `).join('')}
                        </div>
                    `;
                    container.appendChild(folderSection);
                });
            });
        }

        function toggleFolder(id) {
            const el = document.getElementById(id);
            el.style.display = (el.style.display === 'block') ? 'none' : 'block';
        }

        // 4. PRAYER SUBMISSION
        function submitPrayer() {
            const text = document.getElementById('prayer-input').value;
            if(!text) return;
            db.ref('prayers').push({
                text: text,
                timestamp: Date.now(),
                status: 'Sent'
            }).then(() => {
                alert("Prayer request sent to the ministry.");
                document.getElementById('prayer-input').value = "";
            });
        }

        // Initial Loads
        window.onload = () => {
            loadUpdates();
            loadSermons();
            // loadDevotional logic would go here
        };

    </script>
</body>
</html>
